# 메이플스토리 화폐 변환 계산기

## 프로젝트 개요
메이플스토리 게임의 복잡한 화폐 교환 시스템을 시각화하고 최적의 변환 경로를 찾아주는 웹 애플리케이션입니다.

## 기술 스택
- **Frontend**: React 19 + Vite
- **Visualization**: D3.js v7
- **Styling**: CSS Modules

## 핵심 기능

### 1. 화폐 시스템
- **현금 (KRW)**: 실제 화폐
- **넥슨캐시 (NX)**: 게임 내 결제 수단
- **메이플포인트 (MP)**: 게임 내 화폐
- **메소 (MESO)**: 게임 내 기본 화폐 (서버 그룹별 분리)
  - 일반섭 메소 (GROUP1)
  - 에오스 메소 (GROUP2)  
  - 챌린저스 메소 (GROUP3)
- **솔 에르다 조각**: 게임 내 특수 아이템 (서버 그룹별 분리)

### 2. 변환 경로
- **직접 변환**: KRW → NX → MP
- **메소마켓**: MP ↔ 메소 (그룹별 시세)
- **현금거래**: KRW ↔ 메소, KRW ↔ 솔 에르다 조각 (MVP 등급별 수수료)
- **캐시템 경매장**: NX → 메소 (일방향, MVP 등급별 수수료)
- **솔 에르다 거래**: 메소 ↔ 솔 에르다 조각 (그룹별 시세)
- **상품권 할인**: 컬처랜드, 도서문화상품권, 넥슨카드 (월 한도 20만원, 5-6% 할인)

### 3. 수수료 체계
- **메소마켓**: 메소 → MP 시 1% 수수료, MP → 메소 시 수수료 없음
- **현금거래**: MVP 실버 이상 3%, 미만 5% (구매자 부담)
- **캐시템 경매장**: MVP 실버 이상 3%, 미만 5% (구매자 부담)
- **솔 에르다 거래**: MVP 실버 이상 3%, 미만 5% (메소 구매자 부담)
- **상품권**: 종류별 할인율 설정 가능

### 4. 마일리지 시스템
- **보유 마일리지 입력**: 전체 보유량
- **마일리지 변환 비율**: 각 월드별로 "마일리지의 캐시 변환 비율(%)" 설정
  - 예: 30%로 설정 시 10,000 마일리지 = 3,000 캐시로 환산
- **캐시템 효율 계산**: 메소 / (사용 캐시 + 환산된 마일리지) 기준
- **마일리지 가치 계산기**: 
  - 마일리지 미사용/사용 품목 쌍 선택
  - 선택된 쌍으로 마일리지의 캐시 변환 비율 계산
  - 모든 가능한 쌍의 비율 통계 제공
- **수동 버튼 방식**: 설정 변경 후 수동으로 업데이트 버튼 클릭 필요

### 5. UI 특징
- **D3.js 네트워크 그래프**: 화폐 간 변환 관계 시각화
- **접기/펼치기 결과**: 변환 경로를 요약하여 표시, 클릭 시 상세 정보
- **수동 계산 시스템**: 성능 최적화를 위해 버튼 클릭 방식으로 변경
- **설정 변경 추적**: 설정 변경 시 시각적 피드백으로 업데이트 필요 알림

## 파일 구조
```
src/
├── App.jsx                    # 메인 애플리케이션
├── App.css                    # 글로벌 스타일
├── components/
│   ├── AmountInput.jsx        # 금액 입력 컴포넌트
│   ├── CurrencyGraph.jsx      # D3.js 네트워크 그래프
│   ├── GraphSection.jsx       # 그래프 섹션 컴포넌트
│   ├── PathSummary.jsx        # 변환 경로 요약 컴포넌트
│   ├── ResultsSection.jsx     # 결과 표시 섹션
│   ├── SettingsPanel.jsx      # 설정 패널 컴포넌트
│   └── *.css                  # 각 컴포넌트별 전용 스타일
├── hooks/
│   └── useCurrencySettings.js # 화폐 설정 상태 관리 훅
├── config/
│   └── defaultSettings.js     # 기본 설정값 및 검증 로직
└── utils/
    ├── graphPathfinder.js     # 변환 로직 및 포맷팅 (중앙화)
    └── configLoader.js        # 설정 파일 로드/저장 유틸리티
```

## 개발 명령어
```bash
# 개발 서버 실행
npm run dev

# 빌드
npm run build

# 빌드 미리보기
npm run preview
```

## 숫자 포맷팅 규칙
- **현금/넥슨캐시/메이플포인트**: 1원 단위까지 표시
- **메소**: 만 메소 단위까지 표시 (10,000 메소 단위)
- **억/만 단위**: 12억 3456만 7890 형태로 표시 (콤마 없음)

## 주요 설정
- **MVP 등급**: 실버 미만 / 실버 이상
- **메소마켓 시세**: 그룹별 설정 (그룹1+3 통합, 그룹2 별도)
- **현금거래 시세**: 그룹별 설정
- **캐시템 경매장 시세**: 그룹별 메소/캐시 비율 설정
- **솔 에르다 조각 거래**: 현금거래 및 메소거래 시세 설정
- **상품권 할인**: 종류별 할인율 및 월 한도 설정

## 설정 관리
- **기본 설정**: `config/defaultSettings.js`에서 초기값 관리
- **설정 검증**: 잘못된 설정값 자동 감지 및 경고
- **설정 병합**: 사용자 설정과 기본 설정 자동 병합
- **외부 설정**: JSON 파일을 통한 설정 로드/저장 지원
- **브라우저 저장**: localStorage를 통한 사용자 설정 보존

## 변환 경로 예시
1. **KRW → 메소**: 메소마켓 경유 vs 현금거래 직접 vs 캐시템 경매장
2. **KRW → MP**: 직접 변환 vs 각 그룹 현금거래 → 메소마켓 경유
3. **메소 → MP**: 메소마켓 이용 (1% 수수료)
4. **MP → 메소**: 메소마켓 이용 (수수료 없음)

## 개발 현황

### 완료된 작업 ✅
- [x] D3.js 라이브러리 설치 및 기본 설정
- [x] 화폐 노드 데이터 구조 설계 (현금, NX, MP, 그룹별 메소)
- [x] 변환 경로 엣지 데이터 구조 설계
- [x] 기존 변환 결과 UI 제거 및 D3 컴포넌트 준비
- [x] 변환 결과를 간결한 한 줄 표시로 바꾸고 클릭으로 상세 펼치기 기능 추가
- [x] UI 레이아웃 개선 - 일반섭/에오스/챌린저스 표기 통일
- [x] 변환 경로 컴포넌트 너비 확장 및 스타일 개선
- [x] 변환할 금액 입력 필드 위치 개선
- [x] 메소 숫자 포맷팅을 만 단위까지 표시하도록 수정
- [x] CLAUDE.md 프로젝트 문서화 작성
- [x] 무한동력(arbitrage) 감지 시스템 구현
- [x] 캐시템 경매장 다중 아이템 최적화 구현
- [x] 마일리지 시스템 기본 구현
- [x] 변환 경로 효율 기준 정렬
- [x] 캐시/마일리지 사용량 상세 표시
- [x] 마일리지 시스템 재설계 (100% 사용 시 무한대 효율 문제 해결)
- [x] 수동 계산 버튼 시스템 도입 (성능 최적화)
- [x] 그래프 업데이트와 무한동력 감지 통합
- [x] 설정 변경 시 시각적 피드백 시스템

### 진행 중인 작업 🔄
- 현재 진행 중인 작업 없음

### 향후 계획 📋
- 모든 주요 기능 완료!

### 최근 변경사항 📝
- **2025-06-27**: 마일리지 시스템 재설계 및 수동 계산 버튼 도입
  - 마일리지 100% 사용 시 무한대 효율 문제 해결
  - 순환 논리 제거: 수동 변환 비율 설정으로 전환  
  - 자동 계산을 수동 버튼 트리거 방식으로 변경 (성능 최적화)
  - 그래프 업데이트와 무한동력 감지를 하나의 버튼으로 통합
  - 설정 변경 시 시각적 피드백 추가 (업데이트 필요 알림)
- **2025-06-27**: 무한동력 감지 알고리즘 단순화 (서브사이클 제거 로직 개선)
- **2025-06-27**: 마일리지 시스템 구현 및 가치 계산기 추가
- **2025-06-27**: 구매가/판매가 분리 및 체크박스-입력 필드 연동 개선
- **2025-06-22**: 설정 관리 시스템 구축 (config 파일 분리, 검증, 병합)
- **2025-06-22**: 외부 설정 파일 지원 및 설정 import/export 기능
- **2025-06-22**: 캐시템 경매장 기능 추가 (NX → 메소 일방향 변환)
- **2025-06-22**: 솔 에르다 조각 거래 시스템 구현 (현금/메소 거래)
- **2025-06-22**: 레거시 currencyConverter.js 제거 및 로직 중앙화
- **2025-06-22**: 모든 계산 로직을 graphPathfinder.js로 통합
- **2025-06-21**: 그래프 기반 경로 탐색 알고리즘 구현

## 개발 노트
- 모든 변환 로직은 `graphPathfinder.js`에 그래프 기반으로 구현
- D3.js로 directed graph 시각화 (고정 레이아웃: 3층 구조)
- 직관적인 화폐 계층 구조: 현금 → 넥슨캐시/메이플포인트 → 각 월드 메소
- React 상태 관리로 실시간 계산 및 UI 업데이트
- 툴팁과 호버 효과로 사용자 친화적 인터페이스

## 이슈 및 해결사항
### 해결된 이슈
- **MVP 등급 선택 오류**: MVP_BENEFITS 객체 구조 단순화로 해결
- **숫자 포맷팅 문제**: formatNumber 함수에 타입 파라미터 추가로 해결
- **노드 선택 오류**: selectedNode/selectedTarget props 전달로 해결
- **null 참조 오류**: optional chaining과 백업 상태 추가로 해결
- **마일리지 100% 사용 시 무한대 효율**: 마일리지를 캐시로 환산하여 총 비용에 포함하는 방식으로 해결
- **마일리지 가치 계산의 순환 논리**: 자동 계산을 제거하고 수동 비율 설정 방식으로 전환
- **성능 이슈**: 실시간 계산을 수동 버튼 트리거 방식으로 변경하여 해결

### 알려진 제한사항
- D3.js force-directed 시뮬레이션 미구현 (고정 위치 사용)
- 캐시템 경매장 및 솔 에르다 조각 가격은 예시값 (실제 시세 반영 필요)
- 상품권 할인 계산은 단순화된 로직 사용
- 서버별 시세 차이는 수동 입력 방식